version
#samtools v.1.2
#bowtie2 v2.2.5
#tophat v.2.0.14
#cufflinks/ cuffmerge/cuffcompare/ cuffdiff v2.2.1


#Build a bowtie2 index
$mkdir athal
$bowtie2-build athal_chr.fa athal/athal
$cd athal
$ls
>athal.1.bt2 athal.2.bt2 athal.3.bt2 athal.4.bt2 athal.rev.1.bt2 athal.rev.2.bt2

$cp athal_chr.fa athal/
$mkdir tophat_output8
$mkdir tophat_output16
$tophat -o tophat_output8 athal/athal Day8.fastq
$tophat -o tophat_output16 athal/athal Day16.fastq


#1 How many alignments were produced for the 'Day8' RNA-seq data set?
$cd tophat_output8
$samtools view accepted_hits.bam | wc -l
>63845

#2 How many alignments were produced for the 'Day16' RNA-seq data set?
$cd tophat_output16
$samtools view accepted_hits.bam | wc -l
>58398


#3 How many reads were mapped in 'Day8' RNA-seq data set?
$cd tophat_output8
$more align_summary.txt
>Reads:
>Input : 63573
>Mapped : 63489 (99.9% of input)
>of these: 356 (0.6%) have multiple alignments (0 have >= 20)
>99.9% overall read mapping rate.


#4 How many reads were mapped in 'Day16' RNA-seq data set?
$cd tophat_output16
$more align_summary.txt
>Reads:
>Input : 57985
>Mapped : 57951 (99.9% of input)
>of these: 447 (0.8%) have multiple alignments (0 have >= 20)
>99.9% overall read mapping rate.

#5 How many reads were uniquely aligned in 'Day8' RNA-seq data set?
>63489-356=63133

#6 How many reads were uniquely aligned in 'Day16' RNA-seq data set?
>57951-447=57504

#7 How many spliced alignments were reported for 'Day8' RNA-seq data set?
$samtools view accepted_hits.bam | cut -f6 | grep -c 'N'
>8596

#8 How many spliced alignments were reported for 'Day16' RNA-seq data set?
$samtools view accepted_hits.bam | cut -f6 | grep -c 'N'
>10695

#9 How many reads were left unmapped from 'Day8' RNA-seq data set?
$cd tophat_output8
$samtools view unmapped.bam | wc -l
>84

#10 How many reads were left unmapped from 'Day16' RNA-seq data set?
$cd tophat_output16
$samtools view unmapped.bam | wc -l
>34

#11 How many genes were generated by cufflinks for Day8?
$cufflinks -o cufflinks8 -L day8 tophat_output8/accepted_hits.bam
$cd cufflinks8
$cut -f9 transcripts.gtf | cut -d ' ' -f2 | uniq | sort -u | wc -l
>186

#12 How many genes were generated by cufflinks for Day16?
$cufflinks -o cufflinks16 -L day16 tophat_output16/accepted_hits.bam
$cd cufflinks16
$cut -f9 transcripts.gtf | cut -d ' ' -f2 | uniq | sort -u | wc -l
>80

#13 How many transcripts were reported for Day8?
$cut -f9 transcripts.gtf | cut -d ' ' -f4 | uniq | sort -u | wc -l
>192

#14 How many transcripts were reported for Day16?
$cut -f9 transcripts.gtf | cut -d ' ' -f4 | uniq | sort -u | wc -l
>92

#15 How many single transcript genes were produced for Day8?
$cut -f9 transcripts.gtf | cut -d ' ' -f2,4 | sort -u | cut -d ' ' -f1 | sort | uniq -c | grep -c " 1 "
>180

#16 How many single transcript genes were produced for Day16?
$cut -f9 transcripts.gtf | cut -d ' ' -f2,4 | sort -u | cut -d ' ' -f1 | sort | uniq -c | grep -c " 1 "
>69

#17 How many single-exon transcripts were in the Day8 set?
$cut -f9 transcripts.gtf | cut -d ' ' -f4 | sort | uniq -c | grep -c ' 2 '

#18 How many single-exon transcripts were in the Day16 set?
$cut -f9 transcripts.gtf | cut -d ' ' -f4 | sort | uniq -c | grep -c ' 2 '

#19 How many multi-exon transcripts were in the Day8 set?
>192-119=73

#20 How many multi-exon transcripts were in the Day16 set?
>92-24=68

(in the cufflinks result directory)
#21 How many cufflinks transcripts fully reconstruct annotation transcripts in Day8?
$cut -f4 Day8.transcripts.gtf.tmap | grep -c '='
>16

#22 How many cufflinks transcripts fully reconstruct annotation transcripts in Day16?
$cut -f4 Day16.transcripts.gtf.tmap | grep -c '='
>36

#23 How many splice variants does the gene AT4G20240 have in the Day8 sample?
$cat Day8.transcripts.gtf.tmap | grep -c 'AT4G20240'
>2

#24 How many splice variants does the gene AT4G20240 have in the Day16 sample?
$cat Day16.transcripts.gtf.tmap | grep -c 'AT4G20240'
>0

#25 How many cufflinks transcripts are partial reconstructions of reference transcripts('contained')?(Day8)
$cut -f4 Day8.transcripts.gtf.tmap | grep -c 'c'
>134
(substract the header 134-1=133)

#26 How many cufflinks transcripts are partial reconstructions of reference transcripts('contained')?(Day16)
$cut -f4 Day16.transcripts.gtf.tmap | grep -c 'c'
>22
(substract the header 22-1=21)

#27 How many cufflinks transcripts are novel splice variants of reference genes?(Day8)
$cut -f4 Day8.transcripts.gtf.tmap | grep -c 'j'
>14

#28 How many cufflinks transcripts are novel splice variants of reference genes?(Day16)
$cut -f4 Day16.transcripts.gtf.tmap | grep -c 'j'
>22

#29 How many cufflinks transcripts were formed in the introns of reference genes?(Day8)
$cut -f4 Day8.transcripts.gtf.tmap | grep -c 'i'
>4

#30 How many cufflinks transcripts were formed in the introns of reference genes?(Day16)
$cut -f4 Day16.transcripts.gtf.tmap | grep -c 'i'
>1


(/home/guest/Desktop/gencommand_proj4)$sh com.cuffmergediff

#31 How many genes (loci) were reported in the merged.gtf file?
$cat merged.gtf | cut -f9 | cut -d ';' -f1 | sort -u | wc -l
>129

#32 How many transcripts?
$cat merged.gtf | cut -f9 | cut -d ';' -f2 | sort -u | wc -l 
>200

#33 How many genes total were included in the gene expression report from cuffdiff?
$cat gene_exp.diff | cut -f2 | sort -u | wc -l
>130
(130-1=129, substract header)

#34 How many genes were detected as differentially expressed between the two samples?
$cat gene_exp.diff | cut -f14 | grep "yes" | wc -l
>4

#35 How many transcriptions were differentially expressed between the two samples?
$cat isoform_exp.diff | cut -f14 | grep "yes" | wc -l
>5

=========================================================

#GTFs.txt
/home/guest/Desktop/gencommand_proj4/cufflinks8/transcripts.gtf
/home/guest/Desktop/gencommand_proj4/cufflinks16/transcripts.gtf
==========================================================
#com.cuffmergediff
WORKDIR=/home/guest/Desktop/gencommand_proj4/
THDIR=/home/guest/Desktop/gencommand_proj4/Tophat/
ANNOT=/home/guest/Desktop/gencommand_proj4/athal_genes.gtf

mkdir $WORKDIR/Cuffmerge

cd $WORKDIR/Cuffmerge

cuffmerge -g $ANNOT -p 8 -o Cuffmerge $WORKDIR/GTFs.txt

cuffdiff -o Cuffdiff -p 10 $WORKDIR/Cuffmerge/Cuffmerge/merged.gtf\
         $THDIR/Day8/accepted_hits.bam, $THDIR/Day16/accepted_hits.bam
